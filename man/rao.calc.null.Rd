% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/rao.calc.null.R
\name{rao.calc.null}
\alias{rao.calc.null}
\title{Rao's Q (α) null models for vilma objects}
\usage{
rao.calc.null(
  pd,
  tree,
  dist,
  iterations = 999,
  method = c("global", "cell"),
  sampling = c("taxa.label", "range", "neighbor", "regional"),
  n.directions = c("rook", "bishop", "queen"),
  regional.weight = c("uniform", "frequency", "range"),
  abundance = FALSE,
  scale01 = TRUE
)
}
\arguments{
\item{pd}{An object of class \code{vilma.pd} returned by \code{rao.calc()},
containing the observed per-cell RaoQ table (\code{$pd.table}).}

\item{tree}{A rooted phylogeny of class \code{phylo} with branch lengths.}

\item{dist}{A \code{vilma.dist} object (e.g., from \code{points.to.raster()})
that includes \code{$distribution} with columns \code{Cell}, \code{Sp}, and
\code{$grid} used when rasterizing per-cell results.}

\item{iterations}{Integer; number of randomizations (default \code{999}).}

\item{method}{Character; whether to compute null statistics at the
\code{"global"} level (summing RaoQ across cells) or per \code{"cell"}
(default behavior resolves to \code{"global"} if multiple are supplied).}

\item{sampling}{Character; null model type:
\itemize{
\item \code{"taxa.label"} — Shuffle tip labels on the tree; community matrix fixed.
\item \code{"range"} — Swap occurrences in a presence–absence matrix (preserves row/column sums).
\item \code{"neighbor"} — Local swaps between adjacent cells on \code{dist$grid}.
\item \code{"regional"} — Sample species for each cell from the regional pool (see \code{regional.weight}).
}
If multiple options are passed, defaults to \code{"taxa.label"}.}

\item{n.directions}{Neighborhood definition for the \code{"neighbor"} model:
\code{"rook"}, \code{"bishop"}, or \code{"queen"} (default resolves to \code{"queen"}).}

\item{regional.weight}{Weighting of the regional pool for the \code{"regional"} model:
\code{"uniform"} (equal), \code{"frequency"} (by number of records), or
\code{"range"} (by number of occupied cells). Defaults to \code{"uniform"}.}

\item{abundance}{Logical; if \code{FALSE} (default) each Cell×Sp table is binarized
prior to computing proportions; if \code{TRUE} the counts from \code{table(Cell, Sp)}
are used as abundances.}

\item{scale01}{Logical; if \code{TRUE} (default) patristic distances are divided
by their maximum off-diagonal so \eqn{D \in [0,1]} (diagonal set to 0).}
}
\value{
An object of class \code{vilma.null}:
\describe{
\item{\code{pd.obs}}{Observed total RaoQ (global mode) or \code{CellValues$PD} (cell mode).}
\item{\code{null.pd}}{Vector of null totals (global mode) or omitted (cell mode).}
\item{\code{SES}}{Standardized effect size (scalar in global mode; per-cell in cell mode).}
\item{\code{Pvalue}}{Monte Carlo p-value(s).}
\item{\code{CellValues}}{Data frame with per-cell results (cell mode).}
\item{\code{Raster}}{Raster of SES (cell mode).}
\item{\code{Iterations}}{Number of randomizations used.}
\item{\code{Iter.table}}{Matrix of null RaoQ values (rows = cells, cols = iterations).}
\item{\code{Method}}{The string \code{"global"} or \code{"cell"}.}
}
}
\description{
Generates null expectations for \strong{within-community} Rao’s quadratic entropy
(RaoQ; phylogenetic α-diversity) using several randomization schemes, and
computes standardized effect sizes (SES) either \strong{globally} or \strong{per cell}.
}
\details{
For each iteration, a randomized dataset (or tree, for \code{"taxa.label"}) is
produced, and \code{rao.calc()} is evaluated to obtain a null RaoQ per cell.
The function returns either:
\itemize{
\item \strong{Global}: observed sum of RaoQ across cells, the vector of null sums,
and \code{SES = (obs - mean(null)) / sd(null)} with a one-sided
Monte Carlo p-value \eqn{( \#(null \ge obs) + 1 ) / (N + 1)}.
\item \strong{Cell}: per-cell observed RaoQ, null mean and SD, SES per cell,
and per-cell p-values computed the same way, plus a raster of SES.
}

Species are restricted to the intersection between \code{tree$tip.label} and
\code{dist$distribution$Sp}. For \code{"neighbor"}, adjacency is derived from
\code{dist$grid} and the chosen \code{n.directions}. For \code{"regional"},
the number of species sampled in each cell equals its observed richness
(\code{pd$pd.table$SR}), with probabilities defined by \code{regional.weight}.
}
\section{Interpretation}{

Negative SES indicates \strong{phylogenetic clustering} (lower RaoQ than expected),
positive SES indicates \strong{overdispersion} (higher RaoQ than expected), and
SES near 0 suggests random assembly under the chosen null model.
}

\examples{
\dontrun{

tree <- examplae_tree()
dist <- example_dist()
dist <- points_to_raster(dist)

rao <- rao.calc(tree, dist)

out.g <- rao.calc.null(rao, tree = tree, dist = dist,
                       iterations = 999, method = "global",
                       sampling = "taxa.label")
print(out.g)
plot(out.g)
view.vilma(out.g)

# Per-cell SES under regional pool (frequency weights)
out.c <- rao.calc.null(pd = pd_obs, tree = tree, dist = dist,
                       iterations = 499, method = "cell",
                       sampling = "regional", regional.weight = "frequency")
}

}
\references{
Rao, C. R. (1982). Diversity and dissimilarity coefficients: a unified approach.
\emph{Theoretical Population Biology}, 21, 24–43. \cr
Botta-Dukát, Z. (2005). Rao’s quadratic entropy as a measure of functional diversity.
\emph{Community Ecology}, 6, 283–290. \cr
Hardy, O. J. (2008). Testing the spatial phylogenetic structure of local communities:
statistical performances of different null models and test statistics on a locally neutral community.
\emph{Journal of Ecology}, 96(5), 914–926.
}
\seealso{
\code{\link{rao.calc}} for observed α-diversity (RaoQ);
\code{\link{rao.beta}} for Rao β dissimilarity;
\code{\link{points_to_raster}} for building \code{vilma.dist}.
}
\author{
Omar Daniel Leon-Alvarado \url{https://leon-alvarado.weebly.com/}
J. Angel Soto-Centeno \url{https://www.mormoops.com}
}
