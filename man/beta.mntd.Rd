% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/beta.mntd.R
\name{beta.mntd}
\alias{beta.mntd}
\title{Between-community Mean Nearest Taxon Distance (betaMNTD) between communities (cells)}
\usage{
beta.mntd(
  tree,
  dist,
  mntd.method = c("exclude", "root", "node"),
  abundance = FALSE,
  exclude.conspecific = FALSE,
  normalize = FALSE,
  scale01 = FALSE
)
}
\arguments{
\item{tree}{A rooted phylogenetic tree of class \code{phylo} with branch lengths.}

\item{dist}{An object of class \code{vilma.dist} (e.g., from \code{points.to.raster()}),
containing species occurrences per grid cell and a raster grid.}

\item{mntd.method}{Character; how within-cell MNTD is handled when
\code{normalize = TRUE}. Options:
\itemize{
\item \code{"exclude"} - single-species cells excluded (Default).
\item \code{"root"} - singletons use root-to-tip distance.
\item \code{"node"} - singletons use tip-to-nearest-node branch.
}}

\item{abundance}{Logical; if TRUE, compute abundance-weighted betaMNTD.}

\item{exclude.conspecific}{Logical; if TRUE, conspecific matches across
cells are excluded. Default FALSE.}

\item{normalize}{Logical; if TRUE, return
\eqn{betaMNTD_rel = betaMNTD / ((MNTD_A + MNTD_B)/2)}.}

\item{scale01}{Logical; if TRUE, divide betaMNTD matrix by its maximum to
rescale values to \eqn{[0,1]}. Default FALSE.}
}
\value{
A \code{vilma.beta} list containing:
\itemize{
\item \code{distribution} - species distribution
\item \code{bMNTD} - distance object (pairwise betaMNTD)
\item \code{rasters} - SpatRaster layers:
\itemize{
\item \code{mean.bMNTD}
\item \code{pcoa.1}, \code{pcoa.2}
\item \code{nmds.1}, \code{nmds.2}
}
\item \code{pcoa.eig} - eigenvalues
\item \code{nmds.stress} - NMDS stress
\item \code{calculation.method}
\item \code{algorithm} - "beta.mntd"
}
}
\description{
Computes pairwise \strong{betaMNTD} among grid cells and returns:
(i) a betaMNTD distance matrix (larger = more phylogenetically distant at the tip scale), and
(ii) rasters summarizing mean betaMNTD per cell as well as ordination
(PCoA and NMDS) axes mapped to space.

Two variants are provided:
\itemize{
\item \strong{Unweighted (presence/absence)} - betaMNTD is the mean of nearest-taxon
distances in both directions (A to B and B to A).
\item \strong{Weighted (abundances)} - betaMNTD is the expected nearest-taxon distance
using within-cell relative abundances as sampling probabilities.
}
}
\details{
Let \eqn{D_sp} be the patristic distance matrix among species. For two cells:

\strong{Unweighted betaMNTD} (symmetrized):
\deqn{
betaMNTD(A,B) =
0.5 * [
  mean_{i in S_A} min_{j in S_B} d(i,j)
  +
  mean_{j in S_B} min_{i in S_A} d(j,i)
]
}

\strong{Weighted betaMNTD}:
\deqn{
betaMNTD_w(A,B) =
0.5 * [
  sum p_A(i) * min_{j in S_B} d(i,j)
  +
  sum p_B(j) * min_{i in S_A} d(j,i)
]
}

Ordinations (PCoA, NMDS) are computed from the resulting distance matrix.
}
\section{Notes}{

\itemize{
\item Tree must be rooted and have branch lengths.
\item Only shared species are used.
\item \code{normalize = TRUE} uses \code{mntd.calc}.
\item \code{scale01 = TRUE} rescales values for visualization.
}
}

\examples{
\dontrun{
tree <- examplae_tree()
dist <- example_dist()
dist <- points_to_raster(dist)
# Unweighted betaMNTD
bn <- beta.mntd(tree, dist, abundance = FALSE)
print(bn)
plot(bn)

# Weighted betaMNTD
bn_w <- beta.mntd(tree, dist, abundance = TRUE)

# Relative betaMNTD
bn_rel <- beta.mntd(tree, dist, abundance = FALSE, normalize = TRUE)

# Scaled to 0-1
bn_scaled <- beta.mntd(tree, dist, abundance = TRUE, scale01 = TRUE)
}

}
\references{
Webb CO, Ackerly DD, McPeek MA, Donoghue MJ (2002)
Phylogenies and community ecology. Annual Review of Ecology and Systematics 33:475-505.

Miller ET, Farine DR, Trisos CH (2017)
Phylogenetic community structure metrics and null models. Ecology Letters 20:807-818.
}
\seealso{
\code{\link{mntd.calc}}, \code{\link{beta.mpd}}, \code{\link{phylosor.calc}}, \code{\link{unifrac.calc}}
}
\author{
Omar Daniel Leon-Alvarado \url{https://leon-alvarado.weebly.com/}
J. Angel Soto-Centeno \url{https://www.mormoops.com}
}
